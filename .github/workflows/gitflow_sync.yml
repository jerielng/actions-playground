name: Sync main to develop

on:
  push:
    branches:
      - main

jobs:
  sync-main-to-develop:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Attempt to merge main into develop
      run: |
        git fetch origin
        git checkout develop
        git merge origin/main
      continue-on-error: true

    - name: Check if merge was successful
      if: failure()
      run: echo "Merge conflict detected. Creating a pull request instead."

    - name: Create pull request if merge failed
      if: failure()
      run: gh pr create -B main -H develop --title 'Merge `main` back into `develop`' --body 'Generated by GitHub Actions due to merge conflict.'
      env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
